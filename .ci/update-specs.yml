name: update-specs

scms:
  apm-data:
    kind: github
    spec:
      user: '{{ requiredEnv "GIT_USER" }}'
      email: '{{ requiredEnv "GIT_EMAIL" }}'
      owner: elastic
      repository: apm-data
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GIT_USER" }}'
      branch: main
  apm-agent-python:
    kind: github
    spec:
      user: '{{ requiredEnv "GIT_USER" }}'
      email: '{{ requiredEnv "GIT_EMAIL" }}'
      owner: elastic
      repository: apm-agent-python
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GIT_USER" }}'
      branch: main

sources:
  apm-data:
    scmid: apm-data
    kind: json
    spec:
      file: 'https://api.github.com/repos/elastic/apm-data/commits?per_page=1'
      key: '.[0].sha'

actions:
  apm-server-pr:
    kind: github/pullrequest
    scmid: apm-agent-python
    spec:
      automerge: false
      labels:
        - automation

targets:
  spec:
    name: foobar
    sourceid: apm-data
    scmid: apm-agent-python
    kind: shell
    spec:
      command: .ci/scripts/get-specs.sh
      environments:
        - name: PATH

